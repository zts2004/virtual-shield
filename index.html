<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™šå¢ƒç«ç›¾ - å®‰å…¨æ–‡ä»¶è®¿é—®ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- å¼•å…¥ç§‘å¹»å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- èƒŒæ™¯Canvas -->
    <canvas id="bgCanvas"></canvas>

    <!-- å¯†ç éªŒè¯å±‚ -->
    <div id="authLayer" class="auth-layer">
        <div class="auth-box">
            <h2>å®‰å…¨éªŒè¯</h2>
            <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç " maxlength="8">
            <button id="submitBtn">éªŒè¯</button>
            <div id="errorMsg" class="error-msg"></div>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒº -->
    <div id="mainContent" class="main-content hidden">
        <h1 class="title">è™šå¢ƒç«ç›¾</h1>
        <div class="button-container">
            <button class="cyber-btn" data-path="files/é™„ä»¶ä¸€">é™„ä»¶ä¸€</button>
            <button class="cyber-btn" data-path="files/é™„ä»¶äºŒ">é™„ä»¶äºŒ</button>
            <button class="cyber-btn" data-path="files/é™„ä»¶ä¸‰">é™„ä»¶ä¸‰</button>
            <button class="cyber-btn" data-path="files/é™„ä»¶å››">é™„ä»¶å››</button>
            <button class="cyber-btn" data-path="files/è§†é¢‘">è§†é¢‘</button>
        </div>
        
        <!-- æ–‡ä»¶æµè§ˆå™¨ -->
        <div id="fileExplorer" class="file-explorer hidden">
            <div class="file-explorer-header">
                <h2 id="currentPath">æ–‡ä»¶æµè§ˆå™¨</h2>
                <button id="backBtn" class="cyber-btn small">è¿”å›</button>
            </div>
            <div id="fileList" class="file-list"></div>
        </div>

        <!-- æ–‡ä»¶é¢„è§ˆ -->
        <div id="filePreview" class="file-preview hidden">
            <div class="preview-header">
                <h3 id="previewFileName">æ–‡ä»¶é¢„è§ˆ</h3>
                <button id="closePreview" class="cyber-btn small">å…³é—­</button>
            </div>
            <div id="previewContent" class="preview-content"></div>
        </div>
    </div>

    <script>
        // GitHub APIé…ç½®
        const GITHUB_API_BASE = 'https://api.github.com/repos/zts2004/virtual-shield/contents/';
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/zts2004/virtual-shield/main/';

        // å¯†ç éªŒè¯ç›¸å…³å˜é‡
        let loginAttempts = 0;
        const MAX_ATTEMPTS = 3;
        const LOCK_TIME = 15000;
        let isLocked = false;

        // è·å–å½“å‰æ—¥æœŸå¯†ç 
        function getCurrentPassword() {
            const now = new Date();
            return now.getFullYear().toString() +
                   String(now.getMonth() + 1).padStart(2, '0') +
                   String(now.getDate()).padStart(2, '0');
        }

        // éªŒè¯å¯†ç 
        function validatePassword(password) {
            const currentPassword = getCurrentPassword();
            console.log('å½“å‰å¯†ç ï¼š', currentPassword);
            return password === currentPassword;
        }

        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„éªŒè¯çŠ¶æ€
        function checkAuthStatus() {
            const authStatus = localStorage.getItem('authStatus');
            const authTime = localStorage.getItem('authTime');
            if (authStatus === 'true' && authTime) {
                const now = new Date().getTime();
                const authTimestamp = parseInt(authTime);
                if (now - authTimestamp < 24 * 60 * 60 * 1000) {
                    return true;
                }
            }
            return false;
        }

        // æ˜¾ç¤ºä¸»å†…å®¹
        function showMainContent() {
            document.getElementById('authLayer').style.display = 'none';
            document.getElementById('mainContent').classList.remove('hidden');
            // ç¡®ä¿æ–‡ä»¶æµè§ˆå™¨å’Œé¢„è§ˆçª—å£æ˜¯éšè—çš„
            document.getElementById('fileExplorer').classList.add('hidden');
            document.getElementById('filePreview').classList.add('hidden');
        }

        // è·å–æ–‡ä»¶åˆ—è¡¨
        async function fetchFileList(path) {
            try {
                const response = await fetch(GITHUB_API_BASE + path);
                if (!response.ok) throw new Error('è·å–æ–‡ä»¶åˆ—è¡¨å¤±è´¥');
                return await response.json();
            } catch (error) {
                console.error('è·å–æ–‡ä»¶åˆ—è¡¨é”™è¯¯:', error);
                return [];
            }
        }

        // è·å–æ–‡ä»¶å†…å®¹
        async function fetchFileContent(path) {
            try {
                const response = await fetch(GITHUB_RAW_BASE + path);
                if (!response.ok) throw new Error('è·å–æ–‡ä»¶å†…å®¹å¤±è´¥');
                return await response.text();
            } catch (error) {
                console.error('è·å–æ–‡ä»¶å†…å®¹é”™è¯¯:', error);
                return 'æ— æ³•åŠ è½½æ–‡ä»¶å†…å®¹';
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
        function displayFileList(files) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            files.forEach(file => {
                const item = document.createElement('div');
                item.className = 'file-item';
                item.innerHTML = `
                    <span class="file-icon">${file.type === 'dir' ? 'ğŸ“' : 'ğŸ“„'}</span>
                    <span class="file-name">${file.name}</span>
                `;
                
                item.addEventListener('click', async () => {
                    if (file.type === 'dir') {
                        const files = await fetchFileList(file.path);
                        displayFileList(files);
                        document.getElementById('currentPath').textContent = file.path;
                    } else {
                        const content = await fetchFileContent(file.path);
                        showFilePreview(file.name, content);
                    }
                });
                
                fileList.appendChild(item);
            });
        }

        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
        function showFilePreview(fileName, content) {
            const preview = document.getElementById('filePreview');
            const previewFileName = document.getElementById('previewFileName');
            const previewContent = document.getElementById('previewContent');
            
            previewFileName.textContent = fileName;
            
            // æ ¹æ®æ–‡ä»¶ç±»å‹æ˜¾ç¤ºä¸åŒçš„é¢„è§ˆ
            if (fileName.match(/\.(jpg|jpeg|png|gif)$/i)) {
                previewContent.innerHTML = `<img src="${GITHUB_RAW_BASE}${fileName}" alt="${fileName}">`;
            } else if (fileName.match(/\.(mp4|webm)$/i)) {
                previewContent.innerHTML = `
                    <video controls>
                        <source src="${GITHUB_RAW_BASE}${fileName}" type="video/${fileName.split('.').pop()}">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾
                    </video>
                `;
            } else {
                previewContent.innerHTML = `<pre>${content}</pre>`;
            }
            
            preview.classList.remove('hidden');
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç•Œé¢çŠ¶æ€
            const authLayer = document.getElementById('authLayer');
            const mainContent = document.getElementById('mainContent');
            const fileExplorer = document.getElementById('fileExplorer');
            const filePreview = document.getElementById('filePreview');

            // ç¡®ä¿æ‰€æœ‰ç•Œé¢åˆå§‹éƒ½æ˜¯éšè—çš„
            mainContent.classList.add('hidden');
            fileExplorer.classList.add('hidden');
            filePreview.classList.add('hidden');

            // æ£€æŸ¥éªŒè¯çŠ¶æ€
            if (checkAuthStatus()) {
                showMainContent();
            } else {
                authLayer.style.display = 'flex';
            }

            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.getElementById('submitBtn');
            const errorMsg = document.getElementById('errorMsg');
            const backBtn = document.getElementById('backBtn');
            const closePreview = document.getElementById('closePreview');

            // è¿”å›æŒ‰é’®äº‹ä»¶
            backBtn.addEventListener('click', () => {
                fileExplorer.classList.add('hidden');
                document.getElementById('filePreview').classList.add('hidden');
            });

            // å…³é—­é¢„è§ˆæŒ‰é’®äº‹ä»¶
            closePreview.addEventListener('click', () => {
                document.getElementById('filePreview').classList.add('hidden');
            });

            // æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.cyber-btn:not(.small)').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const path = btn.getAttribute('data-path');
                    if (path) {
                        const files = await fetchFileList(path);
                        fileExplorer.classList.remove('hidden');
                        document.getElementById('currentPath').textContent = path;
                        displayFileList(files);
                        // ç¡®ä¿æ–‡ä»¶é¢„è§ˆçª—å£æ˜¯éšè—çš„
                        document.getElementById('filePreview').classList.add('hidden');
                    }
                });
            });

            // å¯†ç éªŒè¯äº‹ä»¶
            submitBtn.addEventListener('click', () => {
                if (isLocked) {
                    errorMsg.textContent = `ç³»ç»Ÿå·²é”å®šï¼Œè¯·ç­‰å¾…${Math.ceil((LOCK_TIME - (Date.now() - lockStartTime)) / 1000)}ç§’`;
                    return;
                }

                const password = passwordInput.value;
                if (validatePassword(password)) {
                    localStorage.setItem('authStatus', 'true');
                    localStorage.setItem('authTime', Date.now().toString());
                    showMainContent();
                    // ç¡®ä¿æ–‡ä»¶æµè§ˆå™¨å’Œé¢„è§ˆçª—å£æ˜¯éšè—çš„
                    fileExplorer.classList.add('hidden');
                    document.getElementById('filePreview').classList.add('hidden');
                } else {
                    loginAttempts++;
                    errorMsg.textContent = `å¯†ç é”™è¯¯ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°ï¼š${MAX_ATTEMPTS - loginAttempts}`;
                    
                    if (loginAttempts >= MAX_ATTEMPTS) {
                        isLocked = true;
                        const lockStartTime = Date.now();
                        errorMsg.textContent = `ç³»ç»Ÿå·²é”å®šï¼Œè¯·ç­‰å¾…15ç§’`;
                        setTimeout(() => {
                            isLocked = false;
                            loginAttempts = 0;
                            errorMsg.textContent = '';
                        }, LOCK_TIME);
                    }
                }
            });
        });

        // CanvasèƒŒæ™¯åŠ¨ç”»
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');

        // è®¾ç½®Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ç²’å­ç³»ç»Ÿ
        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2 + 1;
                this.speedX = Math.random() * 2 - 1;
                this.speedY = Math.random() * 2 - 1;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;

                if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
            }

            draw() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // åˆ›å»ºç²’å­
        const particles = Array.from({ length: 100 }, () => new Particle());

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html> 